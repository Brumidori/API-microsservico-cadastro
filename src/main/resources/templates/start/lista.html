<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0 shrink-to-fit=no" charset="utf-8">
<title>Start</title>
<link href="/imagens/logo_pp.png" rel="icon" type="image/x-icon" />

<link href="/css/main.css" rel="stylesheet" />

<!-- WEBJARS -->
<script src="/webjars/jquery/3.4.1/jquery.min.js"></script>
<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css" />

</head>
<body class="bg-light">
	<!-- Barra de Menu -->
	<section th:insert="barra_de_menu :: barra_de_menu"></section>

	<section class="container">
		<div class="row justify-content-center shadow-sm rounded mt-3 p-3">
			<div class="col-12">
				<h5 class="text-center">Starts</h5>
			</div>
			
			<div class="col-12">
				<form class="mt-2" enctype="multipart/form-data" th:object="${form}">
					<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
					
					<div class="row">
						<div class="col-4 mt-3">
							<div class="input-group input-group">
								<div class="input-group-prepend">
									<div class="input-group-text">Nome</div>
								</div>
								<input class="form-control" type="text" th:field="*{nome}" placeholder="nome">
							</div>
							<p class="text-danger text-center m-0 p-0" th:each="erro : ${#fields.errors('nome')}" th:text="${erro}"></p>
						</div>
						
						<div class="col-4 mt-3">
							<div class="input-group input-group">
								<div class="input-group-prepend">
									<div class="input-group-text">Email</div>
								</div>
								<input class="form-control" type="text" th:field="*{emailUsuario}" placeholder="email">
							</div>
							<p class="text-danger text-center m-0 p-0" th:each="erro : ${#fields.errors('emailUsuario')}" th:text="${erro}"></p>
						</div>
						
						<div class="col-4 mt-3">
							<div class="input-group">
								<div class="input-group-prepend">
									<div class="input-group-text">*Atuação</div>
								</div>
								<select class="form-control" name="atuacao">
									<option th:value="${null}" th:selected="${form.atuacao == null}">Escolha uma...</option>
									<option th:each="e : ${atuacoes}" th:value="${e}" th:text="${e.imprime}" th:selected="${e.equals(form.atuacao)}"></option>
								</select>
							</div>
							<p class="text-danger text-center m-0 p-0" th:each="erro : ${#fields.errors('atuacao')}" th:text="${erro}"></p>
						</div>
				
						<div class="col-4 mt-1">
							<div class="input-group input-group">
								<div class="input-group-prepend">
									<div class="input-group-text">Coach</div>
								</div>
								<input class="form-control" type="text" th:field="*{nomeCoach}" placeholder="coach">
							</div>
							<p class="text-danger text-center m-0 p-0" th:each="erro : ${#fields.errors('nomeCoach')}" th:text="${erro}"></p>
						</div>

						<div class="col-4 mt-1">
							<div class="input-group input-group">
								<div class="input-group-prepend">
									<div class="input-group-text">Gestor</div>
								</div>
								<input class="form-control" type="text" th:field="*{nomeGestor}" placeholder="gestor">
							</div>
							<p class="text-danger text-center m-0 p-0" th:each="erro : ${#fields.errors('nomeGestor')}" th:text="${erro}"></p>
						</div>

						<div class="col-4 mt-1">
							<div class="input-group input-group">
								<div class="input-group-prepend">
									<div class="input-group-text">Turma</div>
								</div>
								<input class="form-control" type="text" th:field="*{nomeTurma}" placeholder="turma">
							</div>
							<p class="text-danger text-center m-0 p-0" th:each="erro : ${#fields.errors('nomeTurma')}" th:text="${erro}"></p>
						</div>
							
					</div>
					<div class="row justify-content-end">					
						<div class="col-2 mt-1">
							<button class="btn btn-primary btn-block" formmethod="post" type="submit" th:formaction="@{/start/listar}">Buscar</button>
						</div>
					</div>
				</form>
			</div>
			
			<div class="col-auto mt-2">
				<table class="table table-hover table-striped  table-responsive table-sm mt-2">
					<thead class="thead-dark">
						<tr>
							<th class="text-left font-weight-normal" scope="col">Nome</th>
							<th class="text-center font-weight-normal" scope="col">Atuação</th>
							<th class="text-center font-weight-normal" scope="col">Turma</th>
							<th class="text-center font-weight-normal" scope="col">Coach</th>
							<th class="text-center font-weight-normal" colspan="2" scope="col">Entrevista de Negócio</th>
							<th class="text-center font-weight-normal" colspan="2" scope="col">Entrevista Técnica</th>
							<th class="text-center font-weight-normal" colspan="3" scope="col">Avaliação</th>
							<th class="text-center font-weight-normal" scope="col">Billable</th>
							<th th:if="${usuario.hasAnyRole('ROLE_EDITAR')}" scope="col" />
						</tr>
					</thead>
					
					<tbody>
						<tr th:each="item : ${lista}" th:style="${'background-color:'+item.cor.corFundo+';color:'+item.cor.corFonte+';'}">
							<td class="text-left align-middle" scope="row">
								<a target="_blank" th:href="@{/start/relatorio(id=${item.id})}" th:text="${item.nome}">Alterar</a>
							</td>
							<td class="text-center align-middle" th:text="${item.atuacao.imprime}" scope="row" />
							<td class="text-center align-middle" th:text="${item.turma.nome}" scope="row" />
							<td class="text-center align-middle" th:text="${item.coach != null ? item.coach.nome : ''}" scope="row" />
							
							<!-- Entrevista de Negocio -->
							<td class="text-center align-middle" scope="row">
								<a th:if="${usuario.hasAnyRole('ROLE_EDITAR') && !item.fezEntrevistaNegocio}" class="btn btn-outline-secondary btn-block btn-sm" th:href="@{/agendamento/entrevista/negocio(idStart=${item.id})}">Agendar</a>
								
								<a th:if="${item.fezEntrevistaNegocio}" data-toggle="collapse" th:href="${'#pen' + item.id}" role="button" aria-expanded="false">
    								Parecer
  								</a>
  								<div th:if="${item.fezEntrevistaNegocio}" class="collapse" th:id="${'pen' + item.id}">
									<div class="card card-body">
								    	<span th:text="${item.parecerEntrevistaNegocio}"></span>
									</div>
								</div>
							</td>
							
							<!-- Entrevista de Negocio -->
							<td class="text-center align-middle" scope="row">
								<label class="m-0 main-font-9 redondo" th:title="${item.farolEntrevistaNegocio.mensagem}" th:text="${'&nbsp&nbsp' + item.farolEntrevistaNegocio.valor + '&nbsp&nbsp'}" 
										th:style="${'background-color:'+item.farolEntrevistaNegocio.corFundo+';color:'+item.farolEntrevistaNegocio.corFonte+';'}"></label>
							</td>

							<!-- Entrevista de Tecnica -->
							<td class="text-center align-middle" scope="row">
								<a th:if="${usuario.hasAnyRole('ROLE_EDITAR') && !item.fezEntrevistaTecnica}" class="btn btn-outline-secondary btn-block btn-sm" th:href="@{/agendamento/entrevista/tecnica(idStart=${item.id})}">Agendar</a>
								<a th:if="${item.fezEntrevistaTecnica}" data-toggle="collapse" th:href="${'#pet' + item.id}" role="button" aria-expanded="false">
    								Parecer
  								</a>
  								<div th:if="${item.fezEntrevistaTecnica}" class="collapse" th:id="${'pet' + item.id}">
									<div class="card card-body">
								    	<span th:text="${item.parecerEntrevistaTecnica}"></span>
									</div>
								</div>							
							</td>

							<!-- Entrevista de Tecnica -->
							<td class="text-center align-middle" scope="row">
								<label class="m-0 main-font-9 redondo" th:title="${item.farolEntrevistaTecnica.mensagem}" th:text="${'&nbsp&nbsp' + item.farolEntrevistaTecnica.valor + '&nbsp&nbsp'}" 
										th:style="${'background-color:'+item.farolEntrevistaTecnica.corFundo+';color:'+item.farolEntrevistaTecnica.corFonte+';'}"></label>
							</td>

							<!-- Avaliacao -->
							<td class="text-center align-middle" scope="row">
								<div th:if="${!item.fezAvaliacaoNoDia && item.coach != null && usuario.nome.equals(item.coach.nome)}">
									<!-- Botão Modal -->
									<button type="button" class="btn btn-outline-secondary btn-sm" data-toggle="modal" th:data-target="${'#modalAvaliar'+item.id}" >Avaliar</button>
									
									<!-- Modal -->
									<div class="modal fade" th:id="${'modalAvaliar'+item.id}" tabindex="-1" role="dialog" aria-labelledby="TituloModalCentralizado" aria-hidden="true">
										<div class="modal-dialog modal-dialog-centered" role="document">
											<form class="modal-content" enctype="multipart/form-data">
												<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
												<input type="hidden" name="nome" th:value="${form.nome}">
												<input type="hidden" name="emailUsuario" th:value="${form.emailUsuario}">
												<input type="hidden" name="atuacao" th:value="${form.atuacao}">
												<input type="hidden" name="nomeCoach" th:value="${form.nomeCoach}">
												<input type="hidden" name="nomeGestor" th:value="${form.nomeGestor}">
												<input type="hidden" name="nomeTurma" th:value="${form.nomeTurma}">
												<input type="hidden" name="idStart" th:value="${item.id}">

												<div class="modal-header">
													<h5 class="modal-title text-center" id="TituloModalCentralizado">Avaliar</h5>
													<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
														<span aria-hidden="true">&times;</span>
													</button>
												</div>
												<div class="modal-body">
													<div class="row">
														<div class="col-12">
															<div class="input-group input-group">
																<div class="input-group-prepend">
																	<div class="input-group-text">*Parecer</div>
																</div>
																<textarea class="form-control" name="parecer" rows="2" maxlength="500" required></textarea>
															</div>
														</div>
														<div class="col-12">
															<div class="form-check form-check-inline" th:each="e : ${farois}">
																<input class="form-check-input" type="radio" name="farol" th:value="${e}" required> 
																<label class="form-check-label redondo mt-1" th:title="${e.mensagem}" th:text="${'&nbsp&nbsp' + e.valor + '&nbsp&nbsp'}" th:style="${'background-color:'+e.corFundo+';color:'+e.corFonte+';'}"></label>
															</div>
														</div>
													</div>
												</div>
												<div class="modal-footer">
													<button class="btn btn-secondary btn-sm" type="button" data-dismiss="modal">Cancelar</button>
													<button class="btn btn-primary btn-sm" formmethod="post" type="submit" th:formaction="@{/avaliacao/lista}">Avaliar</button>
												</div>
											</form>
										</div>
									</div>	
								</div>
							</td>
							
							<!-- Avaliacao -->
							<td class="text-center align-middle" scope="row">
								<a th:if="${item.fezAvaliacao}" data-toggle="collapse" th:href="${'#pa' + item.id}" role="button" aria-expanded="false" th:text="${#temporals.format(item.dataUltimaAvaliacao, 'dd/MM/yyyy')}"></a>
  								<div th:if="${item.fezAvaliacao}" class="collapse" th:id="${'pa' + item.id}">
									<div class="card card-body">
								    	<span th:text="${item.parecerUltimaAvaliacao}"></span>
									</div>
								</div>								
							</td>
							
							<!-- Avaliacao -->
							<td class="text-center align-middle" scope="row">
								<label class="m-0 main-font-9 redondo" th:title="${item.farolUltimaAvaliacao.mensagem}" th:text="${'&nbsp&nbsp' + item.farolUltimaAvaliacao.valor + '&nbsp&nbsp'}" 
										th:style="${'background-color:'+item.farolUltimaAvaliacao.corFundo+';color:'+item.farolEntrevistaTecnica.corFonte+';'}"></label>
							</td>							
																					
							<!-- Billable -->						
							<td class="text-center align-middle" scope="row">
								<div th:if="${
									!item.billable
									&& (usuario.hasAnyRole('ROLE_BILLABLE')
									|| (usuario.hasAnyRole('ROLE_BILLABLE_PROJETO') && item.gestor.email.equals(usuario.username)))
									}">
									<!-- Botão Modal -->
									<button type="button" class="btn btn-outline-primary btn-sm" data-toggle="modal" th:data-target="${'#modalBillable'+item.id}" >Tornar Billable</button>
									
									<!-- Modal -->
									<div class="modal fade" th:id="${'modalBillable'+item.id}" tabindex="-1" role="dialog" aria-labelledby="TituloModalCentralizado" aria-hidden="true">
										<div class="modal-dialog modal-dialog-centered" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title text-center" id="TituloModalCentralizado">Tornar Billable</h5>
													<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
														<span aria-hidden="true">&times;</span>
													</button>
												</div>
												<div class="modal-body">
													Deseja mesmo tornar <span class="font-weight-bold" th:text="${item.nome}"></span> Billable?
												</div>
												<div class="modal-footer">
													<button class="btn btn-secondary btn-sm" type="button" data-dismiss="modal">Cancelar</button>
													<a class="btn btn-primary btn-sm" th:href="@{/start/billable(id=${item.id})}">Tornar Billable</a>
												</div>
											</div>
										</div>
									</div>	
								</div>	
								<span th:if="${item.billable}" class="bg-primary text-white redondo">&nbsp&nbspSim&nbsp&nbsp</span>						
							</td>
														
							<td th:if="${usuario.hasAnyRole('ROLE_EDITAR')}" class="text-center align-middle" scope="row">
								<a class="btn btn-warning btn-sm" th:href="@{/start(id=${item.id})}">Alterar</a>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		
		<section th:insert="mensagem :: mensagem"></section>
	</section>
	
	<script th:if="${sucesso != null || erro != null || alerta != null}" type="text/javascript">
		$("#mensagem").modal("show");	
	</script>	
</body>
</html>