<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0 shrink-to-fit=no" charset="utf-8">
<title>Start</title>
<link href="/imagens/logo_pp.png" rel="icon" type="image/x-icon" />

<link href="/css/main.css" rel="stylesheet" />

<!-- WEBJARS -->
<script src="/webjars/jquery/3.4.1/jquery.min.js"></script>
<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css" />

</head>
<body class="bg-light">
	<section th:fragment="lista_starts (starts, viewAnterior)">
		<table class="table table-hover table-striped  table-responsive table-sm mt-2">
			<thead class="thead-dark">
				<tr>
					<th class="text-left font-weight-normal" scope="col">Nome</th>
					<th class="text-center font-weight-normal" scope="col">Atuação</th>
					<th class="text-center font-weight-normal" scope="col">Turma</th>
					<th class="text-center font-weight-normal" scope="col">Coach</th>
					<th class="text-center font-weight-normal" colspan="2" scope="col">Entrevista de Negócio</th>
					<th class="text-center font-weight-normal" colspan="2" scope="col">Entrevista Técnica</th>
					<th class="text-center font-weight-normal" colspan="3" scope="col">Avaliação</th>
					<th class="text-center font-weight-normal" scope="col">Billable</th>
					<th th:if="${usuario.hasAnyRole('ROLE_EDITAR')}" scope="col" />
				</tr>
			</thead>

			<tbody>
				<tr th:each="item : ${starts}" th:style="${'background-color:'+item.cor.corFundo+';color:'+item.cor.corFonte+';'}">
					<td class="text-left align-middle" scope="row"><a target="_blank" th:href="@{/start/relatorio(id=${item.id})}" th:text="${item.nome}">Alterar</a></td>
					<td class="text-center align-middle" th:text="${item.atuacao.imprime}" scope="row" />
					<td class="text-center align-middle" th:text="${item.turma.nome}" scope="row" />
					<td class="text-center align-middle" th:text="${item.coach != null ? item.coach.nome : ''}" scope="row" />

					<!-- Entrevista de Negocio -->
					<td class="text-center align-middle" scope="row">
						<a th:if="${usuario.hasAnyRole('ROLE_EDITAR') && !item.fezEntrevistaNegocio}" class="btn btn-outline-secondary btn-block btn-sm" th:href="@{/agendamento/entrevista/negocio(idStart=${item.id}, viewAnterior=${viewAnterior})}">Agendar</a>
						<a th:if="${item.fezEntrevistaNegocio}" data-toggle="collapse" th:href="${'#pen' + item.id}" role="button" aria-expanded="false"> Parecer </a>
						
						<div th:if="${item.fezEntrevistaNegocio}" class="collapse" th:id="${'pen' + item.id}">
							<div class="card card-body">
								<span th:text="${item.parecerEntrevistaNegocio}"></span>
							</div>
						</div>
					</td>

					<!-- Entrevista de Negocio -->
					<td class="text-center align-middle" scope="row">
						<section th:insert="~{componente/farol :: farol(${item.farolEntrevistaNegocio})}"></section>
					</td>

					<!-- Entrevista de Tecnica -->
					<td class="text-center align-middle" scope="row">
						<a th:if="${usuario.hasAnyRole('ROLE_EDITAR') && !item.fezEntrevistaTecnica}" class="btn btn-outline-secondary btn-block btn-sm" th:href="@{/agendamento/entrevista/tecnica(idStart=${item.id}, viewAnterior=${viewAnterior})}">Agendar</a> 
						<a th:if="${item.fezEntrevistaTecnica}" data-toggle="collapse" th:href="${'#pet' + item.id}" role="button" aria-expanded="false"> Parecer </a>
						
						<div th:if="${item.fezEntrevistaTecnica}" class="collapse" th:id="${'pet' + item.id}">
							<div class="card card-body">
								<span th:text="${item.parecerEntrevistaTecnica}"></span>
							</div>
						</div>
					</td>

					<!-- Entrevista de Tecnica -->
					<td class="text-center align-middle" scope="row">
						<section th:insert="~{componente/farol :: farol(${item.farolEntrevistaTecnica})}"></section>
					</td>

					<!-- Avaliacao -->
					<td class="text-center align-middle" scope="row">
						<div th:if="${!item.fezAvaliacaoNoDia && item.coach != null && usuario.nome.equals(item.coach.nome)}">
							<!-- Botão Modal -->
							<button type="button" class="btn btn-outline-secondary btn-sm" data-toggle="modal" th:data-target="${'#modalAvaliar'+item.id}">Avaliar</button>

							<!-- Modal -->
							<div class="modal fade" th:id="${'modalAvaliar'+item.id}" tabindex="-1" role="dialog" aria-labelledby="TituloModalCentralizado" aria-hidden="true">
								<div class="modal-dialog modal-dialog-centered" role="document">
									<form class="modal-content" enctype="multipart/form-data">
										<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" /> 
										<input type="hidden" name="idStart" th:value="${item.id}">
										<input type="hidden" name="viewAnterior" th:value="${viewAnterior}">

										<div class="modal-header">
											<h5 class="modal-title text-center" id="TituloModalCentralizado">Avaliar</h5>
											<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
												<span aria-hidden="true">&times;</span>
											</button>
										</div>
										<div class="modal-body">
											<div class="row">
												<div class="col-12">
													<div class="input-group input-group">
														<div class="input-group-prepend">
															<div class="input-group-text">*Parecer</div>
														</div>
														<textarea class="form-control" name="parecer" rows="2" maxlength="500" required></textarea>
													</div>
												</div>
												<div class="col-12">
													<div class="form-check form-check-inline" th:each="e : ${farois}">
														<input class="form-check-input" type="radio" name="farol" th:value="${e}" required> 
														<label class="form-check-label redondo mt-1" th:title="${e.mensagem}" th:text="${'&nbsp&nbsp' + e.valor + '&nbsp&nbsp'}" th:style="${'background-color:'+e.corFundo+';color:'+e.corFonte+';'}"></label>
													</div>
												</div>
											</div>
										</div>
										<div class="modal-footer">
											<button class="btn btn-secondary btn-sm" type="button" data-dismiss="modal">Cancelar</button>
											<button class="btn btn-primary btn-sm" formmethod="post" type="submit" th:formaction="@{/avaliacao/lista}">Avaliar</button>
										</div>
									</form>
								</div>
							</div>
						</div>
					</td>

					<!-- Avaliacao -->
					<td class="text-center align-middle" scope="row">
						<a th:if="${item.fezAvaliacao}" data-toggle="collapse" th:href="${'#pa' + item.id}" role="button" aria-expanded="false" th:text="${#temporals.format(item.dataUltimaAvaliacao, 'dd/MM/yyyy')}"></a>
						
						<div th:if="${item.fezAvaliacao}" class="collapse" th:id="${'pa' + item.id}">
							<div class="card card-body">
								<span th:text="${item.parecerUltimaAvaliacao}"></span>
							</div>
						</div>
					</td>

					<!-- Avaliacao -->
					<td class="text-center align-middle" scope="row">
						<section th:insert="~{componente/farol :: farol(${item.farolUltimaAvaliacao})}"></section>
					</td>

					<!-- Billable -->
					<td class="text-center align-middle" scope="row">
						<div th:if="${
									!item.billable
									&& (usuario.hasAnyRole('ROLE_BILLABLE')
									|| (usuario.hasAnyRole('ROLE_BILLABLE_PROJETO') && item.gestor.email.equals(usuario.email)))
									}">
							<!-- Botão Modal -->
							<button type="button" class="btn btn-outline-primary btn-sm" data-toggle="modal" th:data-target="${'#modalBillable'+item.id}">Tornar Billable</button>

							<!-- Modal -->
							<div class="modal fade" th:id="${'modalBillable'+item.id}" tabindex="-1" role="dialog" aria-labelledby="TituloModalCentralizado" aria-hidden="true">
								<div class="modal-dialog modal-dialog-centered" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title text-center" id="TituloModalCentralizado">Tornar Billable</h5>
											<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
												<span aria-hidden="true">&times;</span>
											</button>
										</div>
										<div class="modal-body">
											Deseja mesmo tornar <span class="font-weight-bold" th:text="${item.nome}"></span> Billable?
										</div>
										<div class="modal-footer">
											<button class="btn btn-secondary btn-sm" type="button" data-dismiss="modal">Cancelar</button>
											<a class="btn btn-primary btn-sm" th:href="@{/start/billable(id=${item.id}, viewAnterior=${viewAnterior})}">Tornar Billable</a>
										</div>
									</div>
								</div>
							</div>
						</div>
						<section th:if="${item.billable}" th:insert="~{componente/billable :: billable}"></section>
					</td>

					<td th:if="${usuario.hasAnyRole('ROLE_EDITAR')}" class="text-center align-middle" scope="row"><a class="btn btn-warning btn-sm" th:href="@{/start(id=${item.id})}">Alterar</a></td>
				</tr>
			</tbody>
		</table>
	</section>
</body>
</html>